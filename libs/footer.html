<ioos-footer></ioos-footer>

<script>
$(function() {
  // prepend IOOS header to top of body
  $('body').prepend('<ioos-header></ioos-header>');

  // move navbar and footer outside main-container for full width
  $('.main-container').after($('ioos-footer'));
  $('.main-container').before($('.navbar'));

  // image zoom
  $('img[data-enlargeable]').addClass('img-enlargeable').click(function() {
    var src = $(this).attr('src');
    var modal;

    function removeModal() {
      modal.remove();
      $('body').off('keyup.modal-close');
    }
    modal = $('<div>').css({
      background: 'RGBA(0,0,0,.5) url(' + src + ') no-repeat center',
      backgroundSize: 'contain',
      width: '100%',
      height: '100%',
      position: 'fixed',
      zIndex: '10000',
      top: '0',
      left: '0',
      cursor: 'zoom-out'
    }).click(function() {
      removeModal();
    }).appendTo('body');
    // handling ESC
    $('body').on('keyup.modal-close', function(e) {
      if (e.key === 'Escape') {
        removeModal();
      }
    });
  });

  // header scroll: fix SanctSound navbar when user scrolls past IOOS header
  headerScroll = function() {
    var ioosHeader = document.querySelector('ioos-header');
    var headerHeight = ioosHeader ? ioosHeader.offsetHeight : 0;

    if ($(this).scrollTop() <= headerHeight) {
      // scrolled to top: navbar flows naturally below IOOS header
      $(".navbar").css({ position: "static", top: "0" });
      $(".main-container").css("margin-top", "0px");
    } else {
      // scrolled past IOOS header: fix navbar to viewport top
      $(".navbar").css({ position: "fixed", top: "0" });
      $(".main-container").css("margin-top", $(".navbar").outerHeight() + "px");
    }
  },
  $(document).scroll(headerScroll),
  window.onresize = function(e) {
    headerScroll()
  },
  headerScroll()
});
</script>

<script>
// force all external links to open in a new tab
// source: https://css-tricks.com/snippets/jquery/open-external-links-in-new-window
$('a').each(function() {
  console.log("a: " + this.href);
  var a = new RegExp('/' + window.location.host + '/');
  if(!a.test(this.href)) {
    console.log("  yes: a.test");
    $(this).click(function(event) {
      event.preventDefault();
      event.stopPropagation();
      window.open(this.href, '_blank');
    });
  }
});
</script>
